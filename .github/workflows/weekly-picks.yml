name: Weekly Picks (manual)

on:
  workflow_dispatch:
    inputs:
      mode:
        type: choice
        description: Choose an action
        options: [status, email_smoke]
        default: status

jobs:
  run:
    runs-on: ubuntu-latest
    steps:
      - name: STATUS
        if: ${{ github.event.inputs.mode == 'status' }}
        run: |
          echo "Workflow is valid ✅"
          echo "Now (Oslo): $(date +'%Y-%m-%d %H:%M:%S %Z')"

      - name: EMAIL_SMOKE — send test email (Bcc to SMTP_TO)
        if: ${{ github.event.inputs.mode == 'email_smoke' }}
        env:
          SMTP_USER: ${{ secrets.SMTP_USER }}
          SMTP_PASS: ${{ secrets.SMTP_PASS }}
          SMTP_TO:   ${{ secrets.SMTP_TO }}
          SMTP_FROM: ${{ secrets.SMTP_FROM }}
        run: |
          python - <<'PY'
          import os, smtplib
          from email.message import EmailMessage
          user=os.environ["SMTP_USER"]; pwd=os.environ["SMTP_PASS"]
          bcc=[e.strip() for e in os.environ.get("SMTP_TO","").split(",") if e.strip()]
          if not user or not pwd or not bcc:
              raise SystemExit("Missing SMTP_USER / SMTP_PASS / SMTP_TO")
          sender=os.environ.get("SMTP_FROM") or user
          msg=EmailMessage(); msg["Subject"]="Smoke test ✉️"; msg["From"]=sender; msg["To"]=sender
          msg.set_content("If you received this, SMTP works. BCC list hidden.")
          with smtplib.SMTP("smtp.office365.com",587,timeout=30) as s:
              s.starttls(); s.login(user,pwd); s.send_message(msg, to_addrs=[sender], bcc_addrs=bcc)
          print("Smoke email sent.")
          PY
